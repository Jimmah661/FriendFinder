<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset='UTF-8'>
    <title>FriendFinder</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>
    <link rel="stylesheet" href="./stylesheets/modal.css">
</head>

<body>
    <div class="container">
        <h2>Question time</h2>
        <hr>
        <form id="aboutYou">
            <h2>About you</h2>
            <div class="form-group">
                <label class="questionText" for="name">Your Name (required)</label>
                <input type="text" class="form-control" id="name" placeholder="Johnny Bravo">
            </div>
            <div class="form-group">
                <label for="photoLink">Link to a current photo (required)</label>
                <input type="url" class="form-control" id="photoLink" placeholder="https://i.imgur.com/TrwuNH2.jpg">
            </div>
            <hr>

            <!-- Test Input for form -->
            <h4>Videogames are an artform</h4>
            <label class="mr-sm-2 sr-only" for="q1">q1</label>
            <select class="custom-select mr-sm-2" id="q1">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h4>True love exists in the world</h4>
            <label class="mr-sm-2 sr-only" for="q2">q2</label>
            <select class="custom-select mr-sm-2" id="q2">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h4>Modals suck, like, big time</h4>
            <label class="mr-sm-2 sr-only" for="q3">q3</label>
            <select class="custom-select mr-sm-2" id="q3">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h4>I love to cook</h4>
            <label class="mr-sm-2 sr-only" for="q4">q4</label>
            <select class="custom-select mr-sm-2" id="q4">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h4>Team sports aren't really my thing</h4>
            <label class="mr-sm-2 sr-only" for="q5">q5</label>
            <select class="custom-select mr-sm-2" id="q5">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h4>I am bored with my current job</h4>
            <label class="mr-sm-2 sr-only" for="q6">q6</label>
            <select class="custom-select mr-sm-2" id="q6">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h4>I am always tired</h4>
            <label class="mr-sm-2 sr-only" for="q7">q7</label>
            <select class="custom-select mr-sm-2" id="q7">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h4>Nothing in life brings me joy</h4>
            <label class="mr-sm-2 sr-only" for="q8">q8</label>
            <select class="custom-select mr-sm-2" id="q8">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h4>Healthcare is a universal right</h4>
            <label class="mr-sm-2 sr-only" for="q9">q9</label>
            <select class="custom-select mr-sm-2" id="q9">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h4>Weddings are way too much effort</h4>
            <label class="mr-sm-2 sr-only" for="q10">q10</label>
            <select class="custom-select mr-sm-2" id="q10">
                <option selected>Choose one...</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>


            <!-- Submit button -->
            <div class="col-12 mt-4">
                <button type="submit" class="btn btn-primary" id="friendMe" data-toggle="modal"
                    data-target="#friendModal">Submit</button>
            </div>
        </form>
        <!-- FORM ENDS HERE -->
        <!-- Trigger/Open The Modal -->
        <button id="myBtn">Open Modal</button>

        <!-- The Modal -->
        <div id="myModal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
                <span class="close">&times;</span>
                <p>Your best friend is <span id='bestFriend'></span></p>
                <p>Check them out!</p>
                <img id="bestFriendPic" src="https://i.imgur.com/TrwuNH2.jpg">
            </div>

        </div>
        <!-- Container ends here -->
    </div>

    <div class="footer">
        <div class="container">
            <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/Jimmah661/FriendFinder">My
                    Github Repo</a></p>
        </div>
    </div>

    <script>
        $("#aboutYou").submit(function (event) {
            event.preventDefault();
            var name = $('#name').val();
            var image = $('#photoLink').val();
            var array = [];
            for (i = 1; i < 11; i++) {
                array.push(parseInt($('#q' + i).val()))
            }


            // POST information to the API
            if (!array.every(function (value) { return Number.isInteger(value) })) {
                alert("Please ensure that all questions have been answered")
            } else if (!image) {
                alert("Please include a link to your image")
            } else if (!name) {
                alert("Please fill in you name")
            } else {
                var data = {
                    "name": name,
                    "photo": image,
                    "scores": array
                }
                calcScores(data.scores);
                $.post('api/friends', { "name": name, "photo": image, "scores": array })
            };
        })

        var calcScores = function (array) {
            $.get('api/friends', function (req, res) {
                var results = [];
                for (i = 0; i < req.length; i++) {
                    var p1 = array
                    var p2 = req[i].scores
                    var compared = []
                    for (j = 0; j < p2.length; j++) {
                        compared.push(Math.abs(p1[j] - p2[j]))
                    }
                    results.push({ 'name': req[i].name, "photo": req[i].photo, 'totalDifference': compared.reduce((a, b) => a + b, 0) })

                }
                var newRes = results.sort(function (a, b) {
                    if (a.totalDifference > b.totalDifference) return 1;
                    if (b.totalDifference > a.totalDifference) return -1;
                    return 0;
                })
                console.log(newRes)
                // alert("Your best match is " + newRes[0].name + " with a difference score of " + newRes[0].totalDifference + "\nCheck them out at " + newRes[0].photo)
                $('#bestFriend').text(newRes[1].name);
                $("#bestFriendPic").attr("src", newRes[1].photo);
                modal.style.display = "block"
            })
        }


        //MODAL SCRIPTING
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on the button, open the modal
        btn.onclick = function () {
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
</body>

</html>